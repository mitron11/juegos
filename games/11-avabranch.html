<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avabranch | Suite Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Bungee&display=swap" rel="stylesheet">
    <style>
        :root {
            --fondo: #102C26;
            --tarjeta: #F7EFCE;
            --primario: #e91e63;
            --acento: #4caf50;
        }

        body {
            margin: 0;
            background: var(--fondo);
            color: var(--tarjeta);
            font-family: 'Bungee', cursive;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            overflow: hidden;
        }

        .game-container {
            position: relative;
            border: 4px solid var(--tarjeta);
            background: #081613;
            box-shadow: 10px 10px 0px var(--primario);
        }

        canvas { display: block; }

        .ui {
            margin-bottom: 15px;
            text-align: center;
        }

        .keys-hint {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .key {
            padding: 5px 12px;
            border: 2px solid var(--tarjeta);
            border-radius: 5px;
            font-size: 0.8rem;
            background: rgba(255,255,255,0.1);
        }

        .key.active {
            background: var(--primario);
            color: white;
            transform: translateY(2px);
        }

        #msg {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--primario);
            padding: 20px;
            border: 3px solid var(--tarjeta);
            display: none;
            text-align: center;
            z-index: 10;
        }

        .back-link { margin-top: 20px; color: var(--tarjeta); text-decoration: none; font-size: 0.8rem; border-bottom: 2px solid var(--primario); }
    </style>
</head>
<body>

    <div class="ui">
        <h2 style="color: var(--primario); margin: 0;">AVABRANCH CLONE</h2>
        <div>PUNTOS: <span id="score">0</span></div>
    </div>

    <div class="game-container">
        <canvas id="gameCanvas" width="600" height="400"></canvas>
        <div id="msg">
            <h2 id="msg-text">¡GAME OVER!</h2>
            <button onclick="resetGame()" style="font-family:'Bungee'; cursor:pointer; padding:10px;">REINTENTAR</button>
        </div>
    </div>

    <div class="keys-hint">
        <div id="key-A" class="key">A</div>
        <div id="key-S" class="key">S</div>
        <div id="key-D" class="key">D</div>
        <div id="key-F" class="key">F</div>
        <div id="key-J" class="key">J</div>
        <div id="key-K" class="key">K</div>
        <div id="key-L" class="key">L</div>
        <div id="key-Ñ" class="key">Ñ</div>
    </div>
    
    <a href="../index.html" class="back-link">VOLVER AL MENÚ</a>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreEl = document.getElementById('score');
        const msgBox = document.getElementById('msg');

        const keyMap = { 'a': 0, 's': 1, 'd': 2, 'f': 3, 'j': 4, 'k': 5, 'l': 6, 'ñ': 7, ';': 7 };
        const keyLabels = ['A', 'S', 'D', 'F', 'J', 'K', 'L', 'Ñ'];
        
        let branches = [];
        let score = 0;
        let gameActive = true;
        let speed = 2;

        function initBranches() {
            branches = [];
            for(let i=0; i<8; i++) {
                branches.push({
                    x: (i * 75) + 37,
                    y: 200,
                    dir: Math.random() > 0.5 ? 1 : -1,
                    active: true,
                    color: i < 4 ? '#e91e63' : '#4caf50'
                });
            }
        }

        function resetGame() {
            score = 0;
            speed = 2;
            gameActive = true;
            msgBox.style.display = 'none';
            initBranches();
        }

        window.addEventListener('keydown', (e) => {
            const key = e.key.toLowerCase();
            if (keyMap.hasOwnProperty(key)) {
                const index = keyMap[key];
                // Visual feedback
                const keyEl = document.getElementById('key-' + keyLabels[index]);
                if(keyEl) {
                    keyEl.classList.add('active');
                    setTimeout(() => keyEl.classList.remove('active'), 100);
                }

                // Lógica de rebote: si pulsas la tecla, la rama cambia de dirección
                if (gameActive) {
                    branches[index].dir *= -1;
                    score += 10;
                    speed += 0.02;
                }
            }
        });

        function update() {
            if (!gameActive) return;

            branches.forEach(b => {
                b.y += (b.dir * speed);

                // Si toca los bordes arriba o abajo, pierdes
                if (b.y <= 0 || b.y >= canvas.height) {
                    gameActive = false;
                    msgBox.style.display = 'block';
                }
            });

            scoreEl.innerText = score;
        }

        function draw() {
            ctx.fillStyle = "#081613";
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Dibujar carriles
            ctx.strokeStyle = "rgba(247, 239, 206, 0.1)";
            for(let i=1; i<8; i++) {
                ctx.beginPath();
                ctx.moveTo(i * 75, 0);
                ctx.lineTo(i * 75, canvas.height);
                ctx.stroke();
            }

            // Dibujar ramas
            branches.forEach((b, i) => {
                ctx.lineWidth = 6;
                ctx.strokeStyle = b.color;
                ctx.shadowBlur = 10;
                ctx.shadowColor = b.color;
                
                ctx.beginPath();
                ctx.moveTo(b.x, b.y - 20);
                ctx.lineTo(b.x, b.y + 20);
                ctx.stroke();
                
                // Dibujar el "nodo" central
                ctx.fillStyle = "#F7EFCE";
                ctx.beginPath();
                ctx.arc(b.x, b.y, 8, 0, Math.PI * 2);
                ctx.fill();
            });
            ctx.shadowBlur = 0;
        }

        function loop() {
            update();
            draw();
            requestAnimationFrame(loop);
        }

        initBranches();
        loop();
    </script>
</body>
</html>
